<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis 3D äº’å‹•é¢æ¿ - è€é—†å°ˆç”¨</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            overflow: hidden;
            color: white;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }
        
        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }
        
        .control-btn {
            background: linear-gradient(45deg, #00ffff, #0080ff);
            border: none;
            color: white;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }
        
        #status {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .jarvis-title {
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            margin: 0 0 10px 0;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="info">
            <h3 class="jarvis-title">ğŸ¤– Jarvis 3D äº’å‹•é¢æ¿</h3>
            <p>è€é—†ï¼Œæ­¡è¿ä½¿ç”¨3Dè¦–è¦ºåŒ–æºé€šç³»çµ±ï¼</p>
            <p>ğŸ–±ï¸ æ»‘é¼ æ‹–æ‹½ï¼šæ—‹è½‰è¦–è§’</p>
            <p>ğŸ¯ æ»‘é¼ æ»¾è¼ªï¼šç¸®æ”¾</p>
            <p>âŒ¨ï¸ Véµï¼šæ–°å¢è»Šå­ | Aéµï¼šè»Šå­å‹•ç•«</p>
        </div>
        
        <div id="status">
            <h4 class="jarvis-title">ğŸ“Š ç³»çµ±ç‹€æ…‹</h4>
            <p id="fps">FPS: --</p>
            <p id="objects">ç‰©ä»¶: --</p>
            <p id="mode">æ¨¡å¼: å±•ç¤º</p>
        </div>
        
        <div id="controls">
            <h4 class="jarvis-title">ğŸ® æ§åˆ¶é¢æ¿</h4>
            <button class="control-btn" onclick="openBox()">ğŸ“¦ æ‰“é–‹ç›’å­</button>
            <button class="control-btn" onclick="closeBox()">ğŸ“¦ é—œé–‰ç›’å­</button>
            <button class="control-btn" onclick="rotateBox()">ğŸ”„ æ—‹è½‰ç›’å­</button>
            <button class="control-btn" onclick="changeColor()">ğŸ¨ è®Šæ›é¡è‰²</button>
            <button class="control-btn" onclick="addSphere()">âšª æ–°å¢çƒé«”</button>
            <button class="control-btn" onclick="addCar()">ğŸš— æ–°å¢è»Šå­</button>
            <button class="control-btn" onclick="startCarAnimation()">ğŸ¬ è»Šå­å‹•ç•«</button>
            <button class="control-btn" onclick="resetScene()">ğŸ”„ é‡ç½®å ´æ™¯</button>
        </div>
    </div>

    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // å…¨åŸŸè®Šæ•¸
        let scene, camera, renderer, controls;
        let box, boxParts = [];
        let spheres = [];
        let cars = [];
        let isBoxOpen = false;
        let animationId;
        let frameCount = 0;
        let lastTime = performance.now();
        let carAnimations = [];
        
        // é¡è‰²é™£åˆ—
        const colors = [0x00ffff, 0xff00ff, 0xffff00, 0xff0000, 0x00ff00, 0x0000ff];
        let currentColorIndex = 0;
        
        // åˆå§‹åŒ–å ´æ™¯
        function init() {
            // å»ºç«‹å ´æ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000011);
            
            // å»ºç«‹ç›¸æ©Ÿ
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
            
            // å»ºç«‹æ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);
            
            // å»ºç«‹è»Œé“æ§åˆ¶å™¨ï¼ˆç°¡åŒ–ç‰ˆï¼‰
            setupControls();
            
            // å»ºç«‹ç‡ˆå…‰
            setupLights();
            
            // å»ºç«‹3Dç›’å­
            createBox();
            
            // å»ºç«‹åœ°é¢
            createGround();
            
            // é–‹å§‹å‹•ç•«å¾ªç’°
            animate();
            
            // è¦–çª—å¤§å°èª¿æ•´
            window.addEventListener('resize', onWindowResize);
            
            console.log('ğŸ¤– Jarvis 3D ç³»çµ±åˆå§‹åŒ–å®Œæˆï¼');
        }
        
        // è¨­ç½®ç‡ˆå…‰
        function setupLights() {
            // ç’°å¢ƒå…‰
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            // æ–¹å‘å…‰
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 1024;
            directionalLight.shadow.mapSize.height = 1024;
            scene.add(directionalLight);
            
            // é»å…‰æº
            const pointLight = new THREE.PointLight(0x00ffff, 0.5, 100);
            pointLight.position.set(0, 5, 0);
            scene.add(pointLight);
        }
        
        // å»ºç«‹3Dç›’å­
        function createBox() {
            const boxGeometry = new THREE.BoxGeometry(2, 2, 2);
            const boxMaterial = new THREE.MeshPhongMaterial({ 
                color: colors[currentColorIndex],
                transparent: true,
                opacity: 0.8
            });
            
            box = new THREE.Mesh(boxGeometry, boxMaterial);
            box.position.set(0, 1, 0);
            box.castShadow = true;
            box.receiveShadow = true;
            scene.add(box);
            
            // å»ºç«‹ç›’å­çš„å„å€‹é¢ï¼ˆç”¨æ–¼é–‹åˆå‹•ç•«ï¼‰
            createBoxParts();
        }
        
        // å»ºç«‹ç›’å­å„éƒ¨åˆ†
        function createBoxParts() {
            // æ¸…é™¤èˆŠçš„éƒ¨åˆ†
            boxParts.forEach(part => scene.remove(part));
            boxParts = [];
            
            // ç›’å­çš„6å€‹é¢
            const faceGeometry = new THREE.PlaneGeometry(2, 2);
            const faceMaterial = new THREE.MeshPhongMaterial({ 
                color: colors[currentColorIndex],
                transparent: true,
                opacity: 0.7,
                side: THREE.DoubleSide
            });
            
            // å‰é¢
            const front = new THREE.Mesh(faceGeometry, faceMaterial.clone());
            front.position.set(0, 1, 1);
            front.userData = { type: 'front', originalPosition: { x: 0, y: 1, z: 1 } };
            
            // å¾Œé¢
            const back = new THREE.Mesh(faceGeometry, faceMaterial.clone());
            back.position.set(0, 1, -1);
            back.userData = { type: 'back', originalPosition: { x: 0, y: 1, z: -1 } };
            
            // å·¦é¢
            const left = new THREE.Mesh(faceGeometry, faceMaterial.clone());
            left.position.set(-1, 1, 0);
            left.rotation.y = Math.PI / 2;
            left.userData = { type: 'left', originalPosition: { x: -1, y: 1, z: 0 } };
            
            // å³é¢
            const right = new THREE.Mesh(faceGeometry, faceMaterial.clone());
            right.position.set(1, 1, 0);
            right.rotation.y = Math.PI / 2;
            right.userData = { type: 'right', originalPosition: { x: 1, y: 1, z: 0 } };
            
            // ä¸Šé¢
            const top = new THREE.Mesh(faceGeometry, faceMaterial.clone());
            top.position.set(0, 2, 0);
            top.rotation.x = Math.PI / 2;
            top.userData = { type: 'top', originalPosition: { x: 0, y: 2, z: 0 } };
            
            // ä¸‹é¢
            const bottom = new THREE.Mesh(faceGeometry, faceMaterial.clone());
            bottom.position.set(0, 0, 0);
            bottom.rotation.x = Math.PI / 2;
            bottom.userData = { type: 'bottom', originalPosition: { x: 0, y: 0, z: 0 } };
            
            boxParts = [front, back, left, right, top, bottom];
            
            // éš±è—åŸå§‹ç›’å­ï¼Œé¡¯ç¤ºå„å€‹é¢
            box.visible = false;
            boxParts.forEach(part => {
                part.castShadow = true;
                part.receiveShadow = true;
                scene.add(part);
            });
        }
        
        // å»ºç«‹åœ°é¢
        function createGround() {
            const groundGeometry = new THREE.PlaneGeometry(20, 20);
            const groundMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x333333,
                transparent: true,
                opacity: 0.5
            });
            
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -1;
            ground.receiveShadow = true;
            scene.add(ground);
        }
        
        // ç°¡åŒ–çš„æ§åˆ¶å™¨
        function setupControls() {
            let isMouseDown = false;
            let mouseX = 0, mouseY = 0;
            let targetRotationX = 0, targetRotationY = 0;
            let currentRotationX = 0, currentRotationY = 0;
            
            renderer.domElement.addEventListener('mousedown', (event) => {
                isMouseDown = true;
                mouseX = event.clientX;
                mouseY = event.clientY;
            });
            
            renderer.domElement.addEventListener('mousemove', (event) => {
                if (isMouseDown) {
                    const deltaX = event.clientX - mouseX;
                    const deltaY = event.clientY - mouseY;
                    
                    targetRotationY += deltaX * 0.01;
                    targetRotationX += deltaY * 0.01;
                    
                    mouseX = event.clientX;
                    mouseY = event.clientY;
                }
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                isMouseDown = false;
            });
            
            // æ»‘é¼ æ»¾è¼ªç¸®æ”¾
            renderer.domElement.addEventListener('wheel', (event) => {
                camera.position.multiplyScalar(event.deltaY > 0 ? 1.1 : 0.9);
                camera.position.clampLength(3, 20);
            });
            
            // æ›´æ–°ç›¸æ©Ÿä½ç½®
            function updateCamera() {
                currentRotationX += (targetRotationX - currentRotationX) * 0.1;
                currentRotationY += (targetRotationY - currentRotationY) * 0.1;
                
                const radius = camera.position.length();
                camera.position.x = radius * Math.sin(currentRotationY) * Math.cos(currentRotationX);
                camera.position.y = radius * Math.sin(currentRotationX);
                camera.position.z = radius * Math.cos(currentRotationY) * Math.cos(currentRotationX);
                camera.lookAt(0, 0, 0);
                
                requestAnimationFrame(updateCamera);
            }
            updateCamera();
        }
        
        // å‹•ç•«å¾ªç’°
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            // æ›´æ–°FPS
            frameCount++;
            const currentTime = performance.now();
            if (currentTime - lastTime >= 1000) {
                document.getElementById('fps').textContent = `FPS: ${frameCount}`;
                frameCount = 0;
                lastTime = currentTime;
            }
            
            // æ›´æ–°ç‰©ä»¶æ•¸é‡
            document.getElementById('objects').textContent = `ç‰©ä»¶: ${scene.children.length}`;
            
            // æ›´æ–°è»Šå­å‹•ç•«
            updateCarAnimations();
            
            // æ¸²æŸ“å ´æ™¯
            renderer.render(scene, camera);
        }
        
        // æ§åˆ¶å‡½æ•¸
        function openBox() {
            if (isBoxOpen) return;
            
            isBoxOpen = true;
            document.getElementById('mode').textContent = 'æ¨¡å¼: é–‹å•Ÿä¸­';
            
            boxParts.forEach(part => {
                const type = part.userData.type;
                switch(type) {
                    case 'front':
                        part.position.z += 2;
                        break;
                    case 'back':
                        part.position.z -= 2;
                        break;
                    case 'left':
                        part.position.x -= 2;
                        break;
                    case 'right':
                        part.position.x += 2;
                        break;
                    case 'top':
                        part.position.y += 2;
                        break;
                }
            });
            
            setTimeout(() => {
                document.getElementById('mode').textContent = 'æ¨¡å¼: å·²é–‹å•Ÿ';
            }, 1000);
        }
        
        function closeBox() {
            if (!isBoxOpen) return;
            
            isBoxOpen = false;
            document.getElementById('mode').textContent = 'æ¨¡å¼: é—œé–‰ä¸­';
            
            boxParts.forEach(part => {
                const original = part.userData.originalPosition;
                part.position.set(original.x, original.y, original.z);
            });
            
            setTimeout(() => {
                document.getElementById('mode').textContent = 'æ¨¡å¼: å·²é—œé–‰';
            }, 1000);
        }
        
        function rotateBox() {
            boxParts.forEach(part => {
                part.rotation.y += Math.PI / 4;
            });
        }
        
        function changeColor() {
            currentColorIndex = (currentColorIndex + 1) % colors.length;
            const newColor = colors[currentColorIndex];
            
            boxParts.forEach(part => {
                part.material.color.setHex(newColor);
            });
        }
        
        function addSphere() {
            const sphereGeometry = new THREE.SphereGeometry(0.5, 16, 16);
            const sphereMaterial = new THREE.MeshPhongMaterial({ 
                color: Math.random() * 0xffffff,
                transparent: true,
                opacity: 0.8
            });
            
            const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
            sphere.position.set(
                (Math.random() - 0.5) * 10,
                Math.random() * 5 + 1,
                (Math.random() - 0.5) * 10
            );
            sphere.castShadow = true;
            sphere.receiveShadow = true;
            
            scene.add(sphere);
            spheres.push(sphere);
        }
        
        // å»ºç«‹3Dè»Šå­æ¨¡å‹
        function createCar() {
            const carGroup = new THREE.Group();
            
            // è»Šèº« (ä¸»é«”)
            const bodyGeometry = new THREE.BoxGeometry(3, 0.8, 1.5);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xff4444 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.4;
            body.castShadow = true;
            carGroup.add(body);
            
            // è»Šé ‚
            const roofGeometry = new THREE.BoxGeometry(1.8, 0.6, 1.3);
            const roofMaterial = new THREE.MeshPhongMaterial({ color: 0xcc3333 });
            const roof = new THREE.Mesh(roofGeometry, roofMaterial);
            roof.position.set(0, 1.1, 0);
            roof.castShadow = true;
            carGroup.add(roof);
            
            // è»Šè¼ª
            const wheelGeometry = new THREE.CylinderGeometry(0.3, 0.3, 0.2, 12);
            const wheelMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
            
            // å‰è¼ª
            const frontLeftWheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            frontLeftWheel.position.set(-1, 0, 0.8);
            frontLeftWheel.rotation.z = Math.PI / 2;
            frontLeftWheel.castShadow = true;
            carGroup.add(frontLeftWheel);
            
            const frontRightWheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            frontRightWheel.position.set(-1, 0, -0.8);
            frontRightWheel.rotation.z = Math.PI / 2;
            frontRightWheel.castShadow = true;
            carGroup.add(frontRightWheel);
            
            // å¾Œè¼ª
            const rearLeftWheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            rearLeftWheel.position.set(1, 0, 0.8);
            rearLeftWheel.rotation.z = Math.PI / 2;
            rearLeftWheel.castShadow = true;
            carGroup.add(rearLeftWheel);
            
            const rearRightWheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            rearRightWheel.position.set(1, 0, -0.8);
            rearRightWheel.rotation.z = Math.PI / 2;
            rearRightWheel.castShadow = true;
            carGroup.add(rearRightWheel);
            
            // è»Šç‡ˆ
            const lightGeometry = new THREE.SphereGeometry(0.15, 8, 8);
            const lightMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xffff00,
                emissive: 0x444400
            });
            
            const leftLight = new THREE.Mesh(lightGeometry, lightMaterial);
            leftLight.position.set(-1.6, 0.6, 0.5);
            carGroup.add(leftLight);
            
            const rightLight = new THREE.Mesh(lightGeometry, lightMaterial);
            rightLight.position.set(-1.6, 0.6, -0.5);
            carGroup.add(rightLight);
            
            // å„²å­˜è»Šè¼ªå¼•ç”¨ä»¥ä¾¿å‹•ç•«
            carGroup.userData.wheels = [frontLeftWheel, frontRightWheel, rearLeftWheel, rearRightWheel];
            
            return carGroup;
        }
        
        // æ–°å¢è»Šå­åˆ°å ´æ™¯
        function addCar() {
            const car = createCar();
            car.position.set(
                (Math.random() - 0.5) * 8,
                0.3,
                (Math.random() - 0.5) * 8
            );
            car.rotation.y = Math.random() * Math.PI * 2;
            
            scene.add(car);
            cars.push(car);
            
            console.log('ğŸš— æ–°å¢äº†ä¸€å°è»Šå­ï¼');
        }
        
        // é–‹å§‹è»Šå­æ—‹è½‰å‹•ç•« (5ç§’é˜)
        function startCarAnimation() {
            if (cars.length === 0) {
                console.log('ğŸš— è«‹å…ˆæ–°å¢è»Šå­ï¼');
                return;
            }
            
            // ç‚ºæ¯å°è»Šå­å»ºç«‹å‹•ç•«
            cars.forEach((car, index) => {
                const animation = {
                    car: car,
                    startTime: performance.now(),
                    duration: 5000, // 5ç§’
                    initialRotation: car.rotation.y,
                    active: true
                };
                carAnimations.push(animation);
            });
            
            document.getElementById('mode').textContent = 'æ¨¡å¼: è»Šå­å‹•ç•«ä¸­';
            console.log('ğŸ¬ é–‹å§‹è»Šå­5ç§’æ—‹è½‰å‹•ç•«ï¼');
        }
        
        // æ›´æ–°è»Šå­å‹•ç•«
        function updateCarAnimations() {
            const currentTime = performance.now();
            
            carAnimations = carAnimations.filter(animation => {
                if (!animation.active) return false;
                
                const elapsed = currentTime - animation.startTime;
                const progress = elapsed / animation.duration;
                
                if (progress >= 1) {
                    // å‹•ç•«å®Œæˆ
                    animation.active = false;
                    console.log('ğŸ¬ è»Šå­å‹•ç•«å®Œæˆï¼');
                    
                    // å¦‚æœæ‰€æœ‰å‹•ç•«éƒ½å®Œæˆï¼Œæ›´æ–°ç‹€æ…‹
                    if (carAnimations.filter(a => a.active).length === 0) {
                        document.getElementById('mode').textContent = 'æ¨¡å¼: å‹•ç•«å®Œæˆ';
                    }
                    return false;
                }
                
                // è¨ˆç®—æ—‹è½‰è§’åº¦ (å®Œæ•´æ—‹è½‰ä¸€åœˆ)
                const rotationAngle = animation.initialRotation + (progress * Math.PI * 2);
                animation.car.rotation.y = rotationAngle;
                
                // è»Šè¼ªæ—‹è½‰å‹•ç•«
                if (animation.car.userData.wheels) {
                    animation.car.userData.wheels.forEach(wheel => {
                        wheel.rotation.x = progress * Math.PI * 8; // è»Šè¼ªè½‰å‹•
                    });
                }
                
                return true;
            });
        }
        
        function resetScene() {
            // ç§»é™¤æ‰€æœ‰çƒé«”
            spheres.forEach(sphere => scene.remove(sphere));
            spheres = [];
            
            // ç§»é™¤æ‰€æœ‰è»Šå­
            cars.forEach(car => scene.remove(car));
            cars = [];
            
            // æ¸…é™¤å‹•ç•«
            carAnimations = [];
            
            // é‡ç½®ç›’å­
            closeBox();
            currentColorIndex = 0;
            changeColor();
            
            document.getElementById('mode').textContent = 'æ¨¡å¼: å·²é‡ç½®';
        }
        
        // è¦–çª—å¤§å°èª¿æ•´
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // éµç›¤æ§åˆ¶
        document.addEventListener('keydown', (event) => {
            switch(event.key.toLowerCase()) {
                case 'o':
                    openBox();
                    break;
                case 'c':
                    closeBox();
                    break;
                case 'r':
                    rotateBox();
                    break;
                case ' ':
                    event.preventDefault();
                    changeColor();
                    break;
                case 's':
                    addSphere();
                    break;
                case 'v':
                    addCar();
                    break;
                case 'a':
                    startCarAnimation();
                    break;
                case 'escape':
                    resetScene();
                    break;
            }
        });
        
        // å•Ÿå‹•ç³»çµ±
        init();
        
        console.log('ğŸ¤– Jarvis 3D äº’å‹•é¢æ¿å·²å•Ÿå‹•ï¼');
        console.log('ğŸ“‹ å¿«æ·éµï¼šO-é–‹å•Ÿ, C-é—œé–‰, R-æ—‹è½‰, ç©ºç™½éµ-è®Šè‰², S-çƒé«”, V-è»Šå­, A-å‹•ç•«, ESC-é‡ç½®');
    </script>
</body>
</html>